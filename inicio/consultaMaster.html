<!DOCTYPE HTML>
<html>
<head>
	<title>GramEXPERT</title>
	<meta charset="utf-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
	<link rel="stylesheet" href="assets/css/main.css"/>
</head>



<body class="is-preload">
<!-- Header -->
<header id="header">

	<div class="inner">
		<center><img id="imagenEquipo" style="width: 70%" alt="" class="aln-center" /></center>

	</div>
</header>
<!-- Main -->
<div id="main">
	<!-- One -->
	<section id="one">
		<header class="major">
			<h2 style="text-align: center">Consulta De Master</h2>
		</header>
		<div class="row gtr-uniform gtr-50">

			<div class="col-12 col-12-xsmall">
				<label  style="text-align: center">Ingrese referencia</label>
				<input type="text" name="emo-id" id="referencia" value="" placeholder="ID"/>
			</div>
			<div class="col-12 col-12-xsmall">
				<center><BUTTON onclick="Buscarequipo()" class="button primary"> Buscar Equipo</BUTTON></center>
			</div>
			<div class="col-6 col-12-xsmall">
				<label style="text-align: center;font-size: 18px;">Id Referencia</label>
				<input type="text" name="demo-name" id="codigo" value="" placeholder="ID">
			</div>
			<div id="filanumparte" class="col-6 col-12-xsmall">
				<label  style="text-align: center;font-size: 18px;">Número de parte</label>
				<input type="text" name="demo-name" id="numparte" value="" placeholder="Num Parte"disabled>
			</div>
			<div id="filaplataforma" class="col-6 col-12-xsmall">
				<label style="text-align: center;font-size: 18px;">Plataforma</label>
				<input type="text" name="demo-name" id="plataforma" value="" placeholder="Plataforma"disabled>
			</div>
			<div id="filacliente" class="col-6 col-12-xsmall">
				<label  style="text-align: center;font-size: 18px;">Cliente</label>
				<input type="text" name="demo-name" id="cliente" value="" placeholder="Cliente"disabled>
			</div>
			<div id="filavendedor" class="col-6 col-12-xsmall">
				<label  style="text-align: center;font-size: 18px">Vendedor</label>
				<input type="text" name="demo-name" id="vendedor" value="" placeholder="Vendedor"disabled>
			</div>
			<div id="filamaterial" class="col-6 col-12-xsmall">
				<label style="text-align: center;font-size: 18px">Material</label>
				<input type="text" name="demo-name" id="material" value="" placeholder="Material"disabled>
			</div>

			<div id="filanombcolor" class="col-6 col-12-xsmall">
				<label  style="text-align: center;font-size: 18px">Nombre del color</label>
				<input type="text" name="demo-name" id="nombcolor" value="" placeholder="Nombre del color"disabled>
			</div>
			<div id="filanumcolor" class="col-6 col-12-xsmall">
				<label  style="text-align: center;font-size: 18px">Número del color</label>
				<input type="text" name="demo-name" id="numcolor" value="" placeholder="Numero del color"disabled>
			</div>

			<div id="filacodcolor" class="col-6 col-12-xsmall">
				<label style="text-align: center;font-size: 18px">Código del color</label>
				<input type="month" name="demo-email" id="codcolor" value="" placeholder="Codigo del color"disabled>
			</div>
			<div id="filastatus" class="col-6 col-12-xsmall">
				<label style="text-align: center;font-size: 18px">Status</label>
				<input type="month" name="demo-email" id="status" value="" placeholder="Status"disabled>
			</div>
			<div id="filanumtarget" class="col-6 col-12-xsmall">
				<label style="text-align: center;font-size: 18px">Número de target</label>
				<input type="text" name="demo-email" id="numtarget" value="" placeholder="Numero de target"disabled>
			</div>

			<div id="filanuminterno" class="col-6 col-12-xsmall">
				<label style="text-align: center;font-size: 18px">Número interno</label>
				<input type="text" name="demo-email" id="numinterno" value="" placeholder="Numero interno"disabled>
			</div>

			<div id="filagrabado" class="col-6 col-12-xsmall">
				<label style="text-align: center;font-size: 18px">Grabado</label>
				<input type="text" name="demo-email" id="grabado" value="" placeholder="Grabado"disabled>
			</div>

			<div id="filafrecuencia" class="col-6 col-12-xsmall">
				<label style="text-align: center;font-size: 18px">Frecuencia</label>
				<input type="text" name="demo-email" id="frecuencia" value="" placeholder="Frecuencia"disabled>
			</div>

			<div id="filaverificacion" class="col-6 col-12-xsmall">
				<label style="text-align: center;font-size: 18px">Verificación</label>
				<input type="text" name="demo-email" id="verificacion" value="" placeholder="Verificacion"disabled>
			</div>

			<div id="filavencimiento" class="col-6 col-12-xsmall">
				<label style="text-align: center;font-size: 18px">Vencimiento</label>
				<input type="text" name="demo-email" id="vencimiento" value="" placeholder="Vencimiento"disabled>
			</div>

			<div id="filapiezas" class="col-6 col-12-xsmall">
				<label style="text-align: center;font-size: 18px">Cantidad de piezas</label>
				<input type="text" name="demo-email" id="piezas" value="" placeholder="Piezas"disabled>
			</div>
			<div id="filaingreso" class="col-6 col-12-xsmall">
				<label style="text-align: center;font-size: 18px">Fecha de ingreso</label>
				<input type="text" name="demo-email" id="ingreso" value="" placeholder="Ingreso"disabled>
			</div>

			<div id="filacomentario" class="col-12 col-12-xsmall">
				<label style="text-align: center;font-size: 18px">Comentarios</label>
				<input type="text" name="demo-email" id="comentario" value="" placeholder="Comentarios"disabled>
			</div>
		</div>


		<H2>REFERENCIA DE LA UBICACION EN FOTOS</H2>
		<hr>
		<center><img id="imagenUbicacion"  alt="" style="width: 70%"/></center>
		<p></p>
		<div class="col-12 col-12-xsmall">
			<ul class="actions stacked" style="text-align: center">
				 <a class="button solid" onclick="desocultar()">Reportar</a></li>
			</ul>
		</div>
		<center><img id="carga" src="images/carga.gif" style="display: none;width: 50%;"></center>

		<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-body">
						<div id="contenidoReporte" style="display: none">

							<hr>
							<p>
								REPORTA EL PROBLEMA CON ALGUNAS SUGERENCIAS EN EL BOTON DESLIZABLE O
								DESCRIBELO EN EL CUADRO.
							</p>

							<div class="input-group mb-3">
								<span class="input-group-text" >REFERENCIA</span>
								<input type="text" id="referen" name="usuario" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default">
							</div>
							<div class="input-group mb-3">
								<span class="input-group-text" >NOMINA</span>
								<input type="text" id="nomina" name="usuario" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default">
							</div>
							<p></p>
							<div class="input-group mb-3">
								<span class="input-group-text" >REPORTE DE ETIQUETA</span>
								<select id="etiqueta" class="form-select" aria-label="Default select example">
									<option selected value="N/A">Open this select menu</option>
									<option value="ETIQUETA DAÑADA">ETIQUETA DAÑADA</option>
									<option value="NO TIENE ETIQUETA">NO TIENE ETIQUETA</option>
									<option value="NO SE LOGRA LEER EL QR">NO SE LOGRA LEER EL QR</option>
								</select>
							</div>
							<p></p>
							<div class="input-group mb-3">
								<span class="input-group-text" >REPORTAR EQUIPO</span>
								<select id="equipo" class="form-select" aria-label="Default select example">
									<option selected value="N/A">Open this select menu</option>
									<option value="EQUIPO DAÑADO">EQUIPO DAÑADO</option>
									<option value="CALIBRACION VENCIDA">CALIBRACION VENCIDA</option>
									<option value="EQUIPO EXTRAVIADO">EQUIPO EXTRAVIADO</option>
								</select>
							</div>
							<p></p>
							<div class="input-group mb-3">
								<span class="input-group-text" >DESCRIPCION DEL PROBLEMA</span>
								<input type="text" id="descproblema" name="usuario" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default">
							</div>
							<p></p>
							<div class="col-12 col-12-xsmall">
								<ul class="actions stacked" style="text-align: center">
									<li><a class="button solid" onclick="Reporte()">ENVIAR REPORTE</a>
								</ul>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>



	</section>
</div>
</section>


</div>

<!-- Footer -->
<footer id="footer">
	<div class="inner">
		<center>
		<ul class="icons">
			<li><a href="https://arketipo.mx/Metrologia/pantallaInicio/index.html" class="icon brands fa-dribbble">	INICIO<span class="label">Dribbble</span></a></li><br>
            <li><a href="https://arketipo.mx/Metrologia/inicio/altaEquipo.php" class="icon brands fa-dribbble">	INGRESO DE EQUIPO<span class="label">Dribbble</span></a></li><br>
			<li><a ONCLICK="mandarEstudio()" class="icon brands fa-dribbble">	ESTUDIOS Y CERTIFICACIONES<span class="label">Dribbble</span></a></li><br>
			<li><a ONCLICK="mandar()" class="icon brands fa-dribbble">	ACTUALIZAR EQUIPOS<span class="label">Dribbble</span></a></li><br>

		</ul>
		</center>
	</div>
</footer>



<!-- Scripts -->
<script src="assets/js/jquery.min.js"></script>
<script src="assets/js/jquery.poptrox.min.js"></script>
<script src="assets/js/browser.min.js"></script>
<script src="assets/js/breakpoints.min.js"></script>
<script src="assets/js/util.js"></script>
<script src="assets/js/main.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>

	function desocultar() {
		document.getElementById('contenidoReporte').style.display = 'block';
	}
	function getParameterByName(name) {
		name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
		var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
				results = regex.exec(location.search);
		var cadena = results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
		var arrTerminos = cadena.split(',');
		return arrTerminos[0];
	}


	buscarQR(getParameterByName("ID"));

	function buscarQR(id) {

		var proceso,linea;

		$.getJSON('https://arketipo.mx/Metrologia/inicio/dao/daoconsulta.php?referencia='+id, function (data) {

		document.getElementById("codigo").value = data.data[0].IdEquipo;

			if(data.data[0].Status == "Baja"){

						alert("El equipo está dado de baja, verificar con el laboratorio de metrología");
			}else {

				if (data.data[0].Tipo == "") {
					document.getElementById("filaTipo").style.display = 'none';
				} else {
					document.getElementById("tipo").value = data.data[0].Tipo;

					if (data.data[0].Tipo == "ESCALA") {
						document.getElementById("imagenEquipo").src = "images/ER-.jpg";
					} else {
						document.getElementById("imagenEquipo").src = "images/" + data.data[0].IdEquipo + ".jpg"
					}
				}


				if (data.data[0].SubTipo == "") {
					document.getElementById("filaSerie").style.display = 'none';
				} else {
					document.getElementById("subtipo").value = data.data[0].SubTipo;
				}

				if (data.data[0].AreaProceso == "") {
					document.getElementById("filaProceso").style.display = 'none';
				} else {
					proceso = data.data[0].AreaProceso;
				}

				if (data.data[0].AreaLinea == "") {
					document.getElementById("filaLinea").style.display = 'none';
				} else {
					linea = data.data[0].AreaLinea;
				}


				if (data.data[0].AreaOperacion == "") {
					document.getElementById("filaOperacion").style.display = 'none';
				} else {
					document.getElementById("Operacion").value = data.data[0].AreaOperacion;
				}


				if (data.data[0].NombrePersona == "") {
					document.getElementById("filaNomina").style.display = 'none';
				} else {
					document.getElementById("nresponsable").value = data.data[0].NombrePersona;
				}
				if (data.data[0].NominaPersona == "") {
					document.getElementById("filaPersona").style.display = 'none';
				} else {
					document.getElementById("nomresponsable").value = data.data[0].NominaPersona;
				}





				if (data.data[0].FechaInspeccion == "") {
					document.getElementById("filaFechaverificacion").style.display = 'none';
				} else {
					document.getElementById("fechacalibracion").value = data.data[0].FechaInspeccion;
				}

				if (data.data[0].FechaVencimiento == "") {
					document.getElementById("filaFechavencida").style.display = 'none';
				} else {
					document.getElementById("fechavencida").value = data.data[0].FechaVencimiento;
				}

				if (data.data[0].NumSerie == "") {
					document.getElementById("filaSerie").style.display = 'none';
				} else {
					document.getElementById("numserie").value = data.data[0].NumSerie;
				}

				if (data.data[0].NumParte == "") {
					document.getElementById("filaParte").style.display = 'none';
				} else {
					document.getElementById("numparte").value = data.data[0].NumParte;
				}

				if (data.data[0].Resolucion == "") {
					document.getElementById("filaResolucion").style.display = 'none';
				} else {
					document.getElementById("resolucion").value = data.data[0].Resolucion;
				}

				if (data.data[0].Nominal == "") {
					document.getElementById("filaNominal").style.display = 'none';
				} else {
					document.getElementById("nominal").value = data.data[0].Nominal;
				}
				if (data.data[0].EspMin == "") {
					document.getElementById("filaEspMin").style.display = 'none';
				} else {
					document.getElementById("minima").value = data.data[0].EspMin;
				}
				if (data.data[0].EspMax == "") {
					document.getElementById("filaEspMax").style.display = 'none';
				} else {
					document.getElementById("maxima").value = data.data[0].EspMax;
				}

				if (data.data[0].Rango == "") {
					document.getElementById("filaRango").style.display = 'none';
				} else {
					document.getElementById("rango").value = data.data[0].Rango;
				}
				if (data.data[0].Status == "") {
					document.getElementById("filaStatus").style.display = 'none';
				} else {
					document.getElementById("status").value = data.data[0].Status;
				}
				if (data.data[0].CentroCosto == "") {
					document.getElementById("filaCentrocosto").style.display = 'none';
				} else {
					document.getElementById("centrocosto").value = data.data[0].CentroCosto;
				}
				if (data.data[0].CodigoCosto == "") {
					document.getElementById("filaCodigocosto").style.display = 'none';
				} else {
					document.getElementById("codigocosto").value = data.data[0].CodigoCosto;
				}

				if (data.data[0].Ntarget == "") {
					document.getElementById("filaTarget").style.display = 'none';
				} else {
					document.getElementById("target").value = data.data[0].Ntarget;
				}

				if (data.data[0].CodColor == "") {
					document.getElementById("filaCodigocolor").style.display = 'none';
				} else {
					document.getElementById("codigoColor").value = data.data[0].CodColor;
				}

				if (data.data[0].ClienteMaster == "") {
					document.getElementById("filaCliente").style.display = 'none';
				} else {
					document.getElementById("cliente").value = data.data[0].ClienteMaster;
				}

				if (data.data[0].PlataformaMaster == "") {
					document.getElementById("filaPlataforma").style.display = 'none';
				} else {
					document.getElementById("plataforma").value = data.data[0].PlataformaMaster;
				}

				if (data.data[0].VendedorMaster == "") {
					document.getElementById("filaVendedormaster").style.display = 'none';
				} else {
					document.getElementById("vendedor").value = data.data[0].VendedorMaster;
				}

				if (data.data[0].NombreColorMaster == "") {
					document.getElementById("filaColormaster").style.display = 'none';
				} else {
					document.getElementById("color").value = data.data[0].NombreColorMaster;
				}

				if (data.data[0].NumColorMaster == "") {
					document.getElementById("filaNumcolor").style.display = 'none';
				} else {
					document.getElementById("numColor").value = data.data[0].NumColorMaster;
				}

				if (data.data[0].Observaciones == "") {
					document.getElementById("filaObservaciones").style.display = 'none';
				} else {
					document.getElementById("observaciones").value = data.data[0].Observaciones;
				}

				if (data.data[0].Frecuencia == "") {
					document.getElementById("filaFrecuencia").style.display = 'none';
				} else {
					document.getElementById("frecuencia").value = data.data[0].Frecuencia;
				}

				consultaFoto(id, proceso, linea);
			}
		});
	}


	function Buscarequipo(){
		var Equipo;
		Equipo=document.getElementById("referencia").value;
			const chars = Equipo.split('-');
<!--
		var ref = chars[0];
-->

			$.getJSON('https://arketipo.mx/Metrologia/inicio/dao/daoconsultaMaster.php?referencia=' + Equipo, function (data) {
				document.getElementById("codigo").value = data.data[0].IdReferencia;

				if(data.data[0].Status == "Baja"){

					alert("El master está dado de baja, verificar con el laboratorio de metrología");
				}else {

					if (data.data[0].NumParte == "") {
						document.getElementById("filanumparte").style.display = 'none';
					} else {
						document.getElementById("numparte").value = data.data[0].NumParte;
					}

					if (data.data[0].Plataforma == "") {
						document.getElementById("filaplataforma").style.display = 'none';
					} else {
						document.getElementById("plataforma").value = data.data[0].Plataforma;
					}

					if (data.data[0].Cliente == "") {
						document.getElementById("filacliente").style.display = 'none';
					} else {
						document.getElementById("cliente").value = data.data[0].Cliente;
					}

					if (data.data[0].Vendedor == "") {
						document.getElementById("filavendedor").style.display = 'none';
					} else {
						document.getElementById("vendedor").value = data.data[0].Cliente;
					}


					if (data.data[0].Material == "") {
						document.getElementById("filamaterial").style.display = 'none';
					} else {
						document.getElementById("material").value = data.data[0].Material;
					}

					if (data.data[0].NombColor == "") {
						document.getElementById("filanombcolor").style.display = 'none';
					} else {
						document.getElementById("nombcolor").value = data.data[0].NombColor;
					}
					if (data.data[0].Grabado == "") {
						document.getElementById("filagrabado").style.display = 'none';
					} else {
						document.getElementById("grabado").value = data.data[0].Grabado;
					}


					if (data.data[0].CodColor == "") {
						document.getElementById("filacodcolor").style.display = 'none';
					} else {
						document.getElementById("codcolor").value = data.data[0].CodColor;
					}


					if (data.data[0].Status == "") {
						document.getElementById("filastatus").style.display = 'none';
					} else {
						document.getElementById("status").value = data.data[0].Status;
					}


					if (data.data[0].Ingreso == "") {
						document.getElementById("filaingreso").style.display = 'none';
					} else {
						document.getElementById("ingreso").value = data.data[0].Ingreso;
					}

					if (data.data[0].NumTarget == "") {
						document.getElementById("filanumtarget").style.display = 'none';
					} else {
						document.getElementById("numtarget").value = data.data[0].NumTarget;
					}

					if (data.data[0].CanPiezas == "") {
						document.getElementById("filapiezas").style.display = 'none';
					} else {
						document.getElementById("piezas").value = data.data[0].CanPiezas;
					}

					if (data.data[0].Comentario == "") {
						document.getElementById("filacomentario").style.display = 'none';
					} else {
						document.getElementById("comentario").value = data.data[0].Comentario;
					}

					if (data.data[0].Verificacion == "") {
						document.getElementById("filaverificacion").style.display = 'none';
					} else {
						document.getElementById("verificacion").value = data.data[0].Verificacion;
					}
					if (data.data[0].Frecuencia == "") {
						document.getElementById("filafrecuencia").style.display = 'none';
					} else {
						document.getElementById("frecuencia").value = data.data[0].Frecuencia;
					}

					if (data.data[0].Vencimiento == "") {
						document.getElementById("filavencimiento").style.display = 'none';
					} else {
						document.getElementById("vencimiento").value = data.data[0].Vencimiento;
					}

				}

			});






	}
	function consultaFoto(Equipo,proceso,linea){
		console.log('https://arketipo.mx/Metrologia/inicio/dao/daoConsultafoto.php?idreferencia='+Equipo);
		$.getJSON('https://arketipo.mx/Metrologia/inicio/dao/daoConsultafoto.php?idreferencia='+Equipo, function (data) {

			document.getElementById("proceso").value = proceso;
			document.getElementById("linea").value = linea;

			document.getElementById("imagenUbicacion").src = "dao/imagenActualizacion/"+data.data[0].IdImagen +".png";
			document.getElementById("proceso").value = data.data[0].AreaProceso;
			document.getElementById("linea").value = data.data[0].Linea;
			//document.getElementById("operacion").value = data.data[0].Operacion;
		});
	}





	function mandar() {
		window.location = "https://arketipo.mx/Metrologia/inicio/actualizarEquipo.php?ID="+document.getElementById("codigo").value;
	}
	function mandarEstudio() {
		window.location = "https://arketipo.mx/Metrologia/inicio/index.html?ID="+document.getElementById("codigo").value;
	}

	function Reporte(){



		var nomina;
		var Retiqueta;
		var Requipo;
		var Descripcion;
		var Referencia;

		nomina = document.getElementById("nomina").value;
		Retiqueta = document.getElementById("etiqueta").value;
		Requipo = document.getElementById("equipo").value;
		Descripcion = document.getElementById("descproblema").value;
		Referencia = document.getElementById("referencia").value;
		if (nomina !=" "){

			document.getElementById("carga").style.display="block";
			document.getElementById("contenidoReporte").style.display="none";



		const data = new FormData();

		data.append('nomina',nomina);
		data.append('Retiqueta', Retiqueta);
		data.append('Requipo', Requipo);
		data.append('Descripcion', Descripcion);
		data.append('Referencia', Referencia);

		fetch('https://arketipo.mx//MailerMetrologia.php', {
			method: 'POST',
			body: data
		})
				.then(function (response) {
					if (response.ok) {
						document.getElementById("carga").style.display="none";
						document.getElementById("contenidoReporte").style.display="block";
						document.getElementById("nomina").value ="";
					} else {
						throw "Error";
					}
				})
				.then(function (texto) {
					console.log(texto);
				})
				.catch(function (err) {
					console.log(err);
				});

		} else {
			Swal.fire({
				icon: "error",
				title: "Campo nomina vacio",
				showConfirmButton: false,
				timer: 1500
			});
		}


	}

</script>

</body>
</html>