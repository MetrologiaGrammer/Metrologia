<!DOCTYPE HTML>
<!--
Minimaxing by HTML5 UP
html5up.net | @ajlkn
Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->

<html>
<head>
    <title>Consulta De equipos</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="assets/css/main.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

</head>
<body>
<div id="page-wrapper">

    <!-- Header -->
    <div id="header-wrapper">
        <div class="container">
            <div class="row">
                <div class="col-12">

                    <header id="header">
                        <h1><a href="index.html" id="logo">Metrología</a></h1>
                        <nav id="nav">
                            <a href="inicio.html">inicio</a>
                            <a href="CONSULTA.html" class="current-page-item">Consulta de Equipos</a>
                            <a href="altaYbaja.html">Ingresos y Bajas De Equipos</a>
                            <a href="actualizacionYreporte.html">Solicitud De Actualizaciones</a>
                            <a href="">Estudios y Certificados de Equipos</a>

                        </nav>
                    </header>

                </div>
            </div>
        </div>
    </div>

    <!-- Main -->
    <div id="main">
        <div class="container">
            <div class="row main-row">
                <div class="col-12 col-12-medium">

                    <section>
                        <h2>Consulta de equipos</h2>
                        <h4>¡Bienvenido!</h4>
                        <p> Puedes consultar los datos y especificaciones para cada instrumento de medición resgistrado en
                            nuestro laboratorio de metrología solo ingresa el ID correspondiente al equipo.</p>

                        <!-- Button trigger modal -->
                        <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#exampleModal">
                            Reportar problema
                        </button>

                        <!-- Modal -->
                        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="exampleModalLabel">REPORTAR PROBLEMA</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <img id="carga" src="images/carga.gif" style="display: none">
                                        <div id="contenidoReporte">
                                        <H6>
                                            REPORTA EL PROBLEMA CON ALGUNAS SUGERENCIAS EN EL BOTON DESLIZABLE O
                                            DESCRIBELO EN EL CUADRO.
                                        </H6>
                                        <hr>
                                        <div class="input-group mb-3">
                                            <span class="input-group-text" >REFERENCIA</span>
                                            <input type="text" id="referencia" name="usuario" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default">
                                        </div>
                                        <div class="input-group mb-3">
                                            <span class="input-group-text" >NOMINA</span>
                                            <input type="text" id="nomina" name="usuario" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default">
                                        </div>
                                        <p></p>
                                        <div class="input-group mb-3">
                                            <span class="input-group-text" >REPORTE DE ETIQUETA</span>
                                            <select id="etiqueta" class="form-select" aria-label="Default select example">
                                                <option selected value="N/A">Open this select menu</option>
                                                <option value="ETIQUETA DAÑADA">ETIQUETA DAÑADA</option>
                                                <option value="NO TIENE ETIQUETA">NO TIENE ETIQUETA</option>
                                                <option value="NO SE LOGRA LEER EL QR">NO SE LOGRA LEER EL QR</option>
                                            </select>
                                        </div>
                                        <p></p>
                                        <div class="input-group mb-3">
                                            <span class="input-group-text" >REPORTAR EQUIPO</span>
                                            <select id="equipo" class="form-select" aria-label="Default select example">
                                                <option selected value="N/A">Open this select menu</option>
                                                <option value="EQUIPO DAÑADO">EQUIPO DAÑADO</option>
                                                <option value="CALIBRACION VENCIDA">CALIBRACION VENCIDA</option>
                                                <option value="EQUIPO EXTRAVIADO">EQUIPO EXTRAVIADO</option>
                                            </select>
                                        </div>
                                        <p></p>
                                        <div class="input-group mb-3">
                                            <span class="input-group-text" >DESCRIPCION DEL PROBLEMA</span>
                                            <input type="text" id="descproblema" name="usuario" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default">
                                        </div>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button id="cerrarModal" type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                        <button type="button" class="btn btn-primary" onclick="Reporte()">Enviar</button>

                                    </div>
                                </div>
                            </div>
                        </div>

                        <center>

                            <label>Ingrese el ID del equipo  </label>
                            <input type="text" id="idrefencia">
                            <p></p>
                            <button ONCLICK="Buscarequipo()" type="button" class="btn btn-primary btn-lg">Buscar Equipo</button>
                            <p></p>
                            <a href="#"><img id="imagenEquipo" src="images/LogoMetrologi.png" alt="" class="aln-center" /></a>
                        </center>


                        <p></p>
                        <div class="input-group mb-3">
                            <span class="input-group-text" >ID DE REFERENCIA</span>
                            <input type="text" id="codigo" name="usuario" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default"disabled>
                        </div>

                        <p></p>
                        <div class="input-group mb-3">
                            <span class="input-group-text" >TIPO</span>
                            <input type="text" id="tipo" name="usuario" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default"disabled>
                        </div>
                        <p></p>
                        <div class="input-group mb-3">
                            <span class="input-group-text" >SUB-TIPO</span>
                            <input type="text" id="sub-tipo" name="usuario" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default"disabled>
                        </div>
                        <p></p>
                        <div class="input-group mb-3">
                            <span class="input-group-text" >AREA/PROCESO</span>
                            <input type="text" id="areaProceso" name="usuario" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default"disabled>
                        </div>
                        <p></p>
                        <div class="input-group mb-3">
                            <span class="input-group-text" >LINEAS/MAQ</span>
                            <input type="text" id="linea" name="usuario" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default"disabled>
                        </div>
                        <p></p>
                        <div class="input-group mb-3">
                            <span class="input-group-text" >OPERACION</span>
                            <input type="text" id="operacion" name="usuario" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default"disabled>
                        </div>
                        <p></p>
                        <div class="input-group mb-3">
                            <span class="input-group-text" >FECHA DE CALIBRACION</span>
                            <input type="text" id="fcalibracion" name="usuario" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default"disabled>
                        </div>
                        <p></p>
                        <div class="input-group mb-3">
                            <span class="input-group-text" >PROXIMA FECHA DE CALIBRACION</span>
                            <input type="text" id="pcalibracion" name="usuario" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default"disabled>
                        </div>
                        <p></p>
                        <div class="input-group mb-3">
                            <span class="input-group-text" >NUM. DE SERIE</span>
                            <input type="text" id="serie" name="usuario" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default" disabled>
                        </div>
                        <p></p>
                        <div class="input-group mb-3">
                            <span class="input-group-text" >NUM. DE PARTE</span>
                            <input type="text" id="parte" name="usuario" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default" disabled>
                        </div>
                        <p></p>
                        <div class="input-group mb-3">
                            <span class="input-group-text" >RESOLUCION</span>
                            <input type="text" id="resolucion" name="observaciones" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default"disabled>
                        </div>
                        <p></p>
                        <div class="input-group mb-3">
                            <span class="input-group-text" >RANGO DEL EQUIPO</span>
                            <input type="text" id="rango" name="observaciones" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default"disabled>
                        </div>
                        <p></p>
                        <div class="input-group mb-3">
                            <span class="input-group-text" >STATUS</span>
                            <input type="text" id="status" name="observaciones" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default"disabled>
                        </div>
                        <p></p>
                        <div class="input-group mb-3">
                            <span class="input-group-text" >OBSERVACIONES</span>
                            <input type="text" id="observaciones" name="observaciones" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default"disabled>
                        </div>

                        <H2>REFERENCIA DE LA UBICACION EN FOTOS</H2>


                        <a href="#"><img id="imagenUbicacion" src="images/pic2.jpg" alt="" class="left" /></a>
                        <P></P>
                        <H3>SOLO CON ACCESO!</H3>
                        <P>Puedes Actualizar Algun Movimiento o Reportar Algun Equipo</P>
                        <a href="actualizacionYreporte.html" class="button">REPORTAR O ACTUALIZAR UN DATO</a>


                        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

                        <script src="assets/js/jquery.min.js"></script>
                        <script src="assets/js/browser.min.js"></script>
                        <script src="assets/js/breakpoints.min.js"></script>
                        <script src="assets/js/util.js"></script>
                        <script src="assets/js/main.js"></script>

                        <script>
                            function getParameterByName(name) {
                                name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
                                var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
                                    results = regex.exec(location.search);
                                var cadena = results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
                                var arrTerminos = cadena.split(',');
                                return arrTerminos[0];
                            }

                            buscarQR(getParameterByName("referencia"));

                            function buscarQR(id) {
                                $.getJSON('https://arketipo.mx/Metrologia/dao/daoconsulta.php?idreferencia='+id, function (data) {
                                    document.getElementById("codigo").value = data.data[0].IdEquipo;
                                    document.getElementById("serie").value = data.data[0].NumSerie;
                                    document.getElementById("tipo").value = data.data[0].Tipo;
                                    document.getElementById("sub-tipo").value = data.data[0].SubTipo;
                                    document.getElementById("areaProceso").value = data.data[0].AreaProceso;
                                    document.getElementById("linea").value = data.data[0].MaqLinea;
                                    document.getElementById("operacion").value = data.data[0].Operacion;
                                    document.getElementById("fcalibracion").value = data.data[0].FechaInspeccion;
                                    document.getElementById("pcalibracion").value = data.data[0].FechaVencimiento;
                                    document.getElementById("serie").value = data.data[0].NumSerie;
                                    document.getElementById("parte").value = data.data[0].NumParte;
                                    document.getElementById("resolucion").value = data.data[0].Resolucion;
                                    document.getElementById("rango").value = data.data[0].RangoInstrumento;
                                    document.getElementById("status").value = data.data[0].Status;
                                    document.getElementById("observaciones").value = data.data[0].Observaciones;

                                });
                            }
                            function Buscarequipo(){
                                var Equipo;
                                Equipo=document.getElementById("idrefencia").value;

                                $.getJSON('https://arketipo.mx/Metrologia/dao/daoconsulta.php?idreferencia='+Equipo, function (data) {
                                    document.getElementById("codigo").value = data.data[0].IdEquipo;
                                    document.getElementById("serie").value = data.data[0].NumSerie;
                                    document.getElementById("tipo").value = data.data[0].Tipo;

                                    if (data.data[0].Tipo == "ESCALA"){
                                        document.getElementById("imagenEquipo").src = "images/ER-100.jpg";
                                    }else{
                                        document.getElementById("imagenEquipo").src = "images/"+data.data[0].IdEquipo+".jpg"
                                    }

                                    document.getElementById("sub-tipo").value = data.data[0].SubTipo;
                                    document.getElementById("areaProceso").value = data.data[0].AreaProceso;
                                    document.getElementById("linea").value = data.data[0].MaqLinea;
                                    document.getElementById("operacion").value = data.data[0].Operacion;
                                    document.getElementById("fcalibracion").value = data.data[0].FechaInspeccion;
                                    document.getElementById("pcalibracion").value = data.data[0].FechaVencimiento;
                                    document.getElementById("serie").value = data.data[0].NumSerie;
                                    document.getElementById("parte").value = data.data[0].NumParte;
                                    document.getElementById("resolucion").value = data.data[0].Resolucion;
                                    document.getElementById("rango").value = data.data[0].RangoInstrumento;
                                    document.getElementById("status").value = data.data[0].Status;
                                    document.getElementById("observaciones").value = data.data[0].Observaciones;



                                });

                                consultaFoto(Equipo);
                            }
                            function consultaFoto(Equipo){
                                $.getJSON('https://arketipo.mx/Metrologia/dao/daoConsultafoto.php?idreferencia='+Equipo, function (data) {

                                    document.getElementById("imagenUbicacion").src = "dao/imagenActualizacion/"+data.data[0].IdImagen+".png";

                                });
                            }

                            function Reporte(){

                                document.getElementById("carga").style.display="block";
                                document.getElementById("contenidoReporte").style.display="none";

                                var nomina;
                                var Retiqueta;
                                var Requipo;
                                var Descripcion;
                                var Referencia;

                                nomina = document.getElementById("nomina").value;
                                Retiqueta = document.getElementById("etiqueta").value;
                                Requipo = document.getElementById("equipo").value;
                                Descripcion = document.getElementById("descproblema").value;
                                Referencia = document.getElementById("referencia").value;

                                const data = new FormData();

                                data.append('nomina',nomina);
                                data.append('Retiqueta', Retiqueta);
                                data.append('Requipo', Requipo);
                                data.append('Descripcion', Descripcion);
                                data.append('Referencia', Referencia);

                                fetch('https://arketipo.mx//MailerMetrologia.php', {
                                    method: 'POST',
                                    body: data
                                })
                                    .then(function (response) {
                                        if (response.ok) {
                                            document.getElementById("cerrarModal").click();
                                            document.getElementById("carga").style.display="none";
                                            document.getElementById("contenidoReporte").style.display="block";
                                            document.getElementById("nomina").value ="";
                                        } else {
                                            throw "Error";
                                        }
                                    })
                                    .then(function (texto) {
                                        console.log(texto);
                                    })
                                    .catch(function (err) {
                                        console.log(err);
                                    });
                            }

                        </script>
                    </section>
                </div>
            </div>
        </div>
    </div>
</div>
                                    <div class="col-12">
                                    <div id="copyright">
                                        &copy; Untitled. All rights reserved. | Design: <a href="http://html5up.net">HTML5 UP</a>
                                    </div>
</div>
</body>
</html>